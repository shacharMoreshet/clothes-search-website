from django.test import TestCase
from ..views import make_shein_request, make_asos_request

# consts :

# Mock response from the Shein API
SHEIN_MOCK_JSON_RESPONSE = {'origin_words': 'black shirt',
                            'products_shein': [{'goods_id': '13094634', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/02/14/1676344310205f8f55dd1c4e08e6dcf84ede15f2c0_thumbnail_405x552.jpg','name': 'SHEIN Unity Contrast Floral Mesh Puff Sleeve Tee','cat_id': '1738', 'price': '$5.49', 'url': 'https://www.shein.com/x-p-13094634-cat-1738.html','sold_by': 'Shein'},
                                               {'goods_id': '14819431', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/04/13/168139020346abcc345999e5580d0566fd142f5d14_thumbnail_405x552.jpg', 'name': 'SHEIN Unity Solid Drawstring Side Tee', 'cat_id': '1738', 'price': '$5.99', 'url': 'https://www.shein.com/x-p-14819431-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '8446817', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2021/12/17/1639722742476e4ba1da50fd03020695eb4bcab725_thumbnail_405x552.jpg', 'name': 'SHEIN BAE Solid Fitted Tee', 'cat_id': '1738', 'price': '$6.49', 'url': 'https://www.shein.com/x-p-8446817-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '9729174', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/01/15/16422491726409e1fe2097a404dd1f9f055fbac5bd_thumbnail_405x552.jpg', 'name': 'Solid V Neck Tee', 'cat_id': '1738', 'price': '$4.99', 'url': 'https://www.shein.com/x-p-9729174-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '10179239', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/03/31/1648690875a8211e9b8e4ca1bfe5345cf096e6334b_thumbnail_405x552.jpg', 'name': 'SHEIN BASICS Solid Form Fitted Tee', 'cat_id': '1738', 'price': '$3.99', 'url': 'https://www.shein.com/x-p-10179239-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '11885681', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/04/24/1682321923f119659ffd06592c7c65023d53a9b023_thumbnail_405x552.jpg', 'name': 'ROMWE Sweetness Solid Contrast Lace Ruched Tee', 'cat_id': '1738', 'price': '$6.49', 'url': 'https://www.shein.com/x-p-11885681-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '2903639', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2021/06/15/162372893685551a1c043c572a5d4aad03b6faf86e_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Solid Round Neck Tee', 'cat_id': '1738', 'price': '$4.99', 'url': 'https://www.shein.com/x-p-2903639-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '11507161', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/09/17/1663393694643f7ea3c53dbf223f816ddade5738f3_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Scoop Neck Rib-knit Crop Tee', 'cat_id': '1738', 'price': '$5.99', 'url': 'https://www.shein.com/x-p-11507161-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '12706550', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/01/09/16732260489691cc12e5bfc7ba47e926544094c99e_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Square Neck Crop Tee', 'cat_id': '1738', 'price': '$6.99', 'url': 'https://www.shein.com/x-p-12706550-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '16078642', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/05/15/168411663808828ddaa3d9c6f1f9febda11c2dc91f_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Solid Ruched Crop Tee', 'cat_id': '1738', 'price': '$6.49', 'url': 'https://www.shein.com/x-p-16078642-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '14213690', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/03/27/1679914918f7fdf91c5cc4b47290f7d6daf19810ad_thumbnail_405x552.jpg', 'name': 'SHEIN Unity Solid Square Neck Tee', 'cat_id': '1738', 'price': '$5.99', 'url': 'https://www.shein.com/x-p-14213690-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '9675977', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/01/13/164205211928ba562369c5a0921c3941c82ff4f4b9_thumbnail_405x552.jpg', 'name': 'SHEIN SXY Drop Shoulder Longline Tee', 'cat_id': '1738', 'price': '$9.49', 'url': 'https://www.shein.com/x-p-9675977-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '10957030', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/06/30/165656564574966c5e882ff2fd13805d4d163d2f00_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Solid Drop Shoulder Oversized Tee', 'cat_id': '1738', 'price': '$6.99', 'url': 'https://www.shein.com/x-p-10957030-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '12344002', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/12/03/167003177673512b4964099a9fa4a23c72e8f7a5c1_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Scoop Neck Flounce Sleeve Crop Tee', 'cat_id': '1738', 'price': '$5.99', 'url': 'https://www.shein.com/x-p-12344002-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '1941180', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2020/12/16/160808918120b7b6823d61ef7034cd1d0fae083d5f_thumbnail_405x552.jpg', 'name': 'SHEIN Unity Solid Form Fitted Tee', 'cat_id': '1738', 'price': '$7.49', 'url': 'https://www.shein.com/x-p-1941180-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '10761627', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/06/06/165450727325b923ffde1b3ca3048f64cf2f7813c1_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Solid Crop Textured Knit Tee', 'cat_id': '1738', 'price': '$4.49', 'url': 'https://www.shein.com/x-p-10761627-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '13940250', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/03/17/1679044651acf2b984fc961f11211dc51b1ac7b67f_thumbnail_405x552.jpg', 'name': 'SHEIN Unity Solid Lettuce Trim Tee', 'cat_id': '1738', 'price': '$6.49', 'url': 'https://www.shein.com/x-p-13940250-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '11904021', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2022/11/01/1667269403105a02d79fc107cd1212995e82643096_thumbnail_405x552.jpg', 'name': 'SHEIN PETITE Solid Scoop Neck Tee', 'cat_id': '1738', 'price': '$6.99', 'url': 'https://www.shein.com/x-p-11904021-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '13767318', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2023/03/11/16785217586ff0ea5798b4b22190136c5754a9a24a_thumbnail_405x552.jpg', 'name': 'Guitar & Letter Graphic Drop Shoulder Tee', 'cat_id': '1738', 'price': '$7.99', 'url': 'https://www.shein.com/x-p-13767318-cat-1738.html', 'sold_by': 'Shein'},
                                               {'goods_id': '3270817', 'img_url': 'http://img.ltwebstatic.com/images3_pi/2021/08/05/162813514600135972cfb7535324ca68fe3519bbb8_thumbnail_405x552.jpg', 'name': 'SHEIN EZwear Solid Rib-knit Tee', 'cat_id': '1738', 'price': '$6.99', 'url': 'https://www.shein.com/x-p-3270817-cat-1738.html', 'sold_by': 'Shein'}]}

SHEIN_FORMATTED_RES = "black shirt"
PRODUCTS_KEY_SHEIN = "products_shein"
PRODUCTS_KEY_ASOS = "products_asos"
ERROR_MESSAGE_SHEIN = "The response of API-SHEIN is incorrect"
ERROR_MESSAGE_ASOS = "The response of API-ASOS is incorrect"
ASOS_COLOR = "black"
ASOS_GENDER = "woman"
ASOS_ITEM_TYPE = "shirt"
ASOS_MOCK_JSON_RESPONSE = {'searchTerm': '',
                           'category_name': 'Tops',
                           'products_asos': [{'name': 'adidas Originals essentials rib tank top in black', 'price': '$26.50', 'colour': 'Black', 'url': 'https://www.asos.com/adidas-originals/adidas-originals-essentials-rib-tank-top-in-black/prd/203843210?clr=black&colourWayId=203843223', 'img_url': 'https://images.asos-media.com/products/adidas-originals-essentials-rib-tank-top-in-black/203843210-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Topshop textured ruched front bandeau in mono', 'price': '$45.00', 'colour': 'MONO', 'url': 'https://www.asos.com/topshop/topshop-premium-knitted-set-in-black-and-white-stripe/grp/205085345?clr=mono&colourWayId=204779272#204779269', 'img_url': 'https://images.asos-media.com/products/topshop-textured-ruched-front-bandeau-in-mono/204779269-1-mono', 'sold_by': 'Asos'},
                                             {'name': 'Love & Other Things lace bodysuit with glitter straps in black', 'price': '$24.00', 'colour': 'Black', 'url': 'https://www.asos.com/love-other-things/love-other-things-lace-bodysuit-with-glitter-straps-in-black/prd/203415395?clr=black&colourWayId=203415397', 'img_url': 'https://images.asos-media.com/products/love-other-things-lace-bodysuit-with-glitter-straps-in-black/203415395-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Miss Selfridge Petite linen look beach maxi shirt in black', 'price': '$51.50', 'colour': 'Black', 'url': 'https://www.asos.com/miss-selfridge/miss-selfridge-petite-linen-look-beach-maxi-shirt-in-black/prd/204411507?clr=black&colourWayId=204411508', 'img_url': 'https://images.asos-media.com/products/miss-selfridge-petite-linen-look-beach-maxi-shirt-in-black/204411507-1-black', 'sold_by': 'Asos'}, {'name': 'Miss Selfridge eyelet cropped t-shirt in black', 'price': '$30.00', 'colour': 'Black', 'url': 'https://www.asos.com/miss-selfridge/miss-selfridge-eyelet-cropped-t-shirt-in-black/prd/204531253?clr=black&colourWayId=204531254', 'img_url': 'https://images.asos-media.com/products/miss-selfridge-eyelet-cropped-t-shirt-in-black/204531253-1-black', 'sold_by': 'Asos'}, {'name': 'Miss Selfridge Premium festival embellished halter top in mono dogtooth - part of a set', 'price': '$58.50', 'colour': 'Black', 'url': 'https://www.asos.com/miss-selfridge/miss-selfridge-premium-festival-embellished-halter-top-in-mono-dogtooth-part-of-a-set/prd/202943816?clr=black&colourWayId=202943817', 'img_url': 'https://images.asos-media.com/products/miss-selfridge-premium-festival-embellished-halter-top-in-mono-dogtooth-part-of-a-set/202943816-1-black', 'sold_by': 'Asos'},
                                             {'name': 'HUGO Dapolino boyfriend fit t-shirt in black', 'price': '$55.50', 'colour': 'Black', 'url': 'https://www.asos.com/hugo/hugo-dapolino-boyfriend-fit-t-shirt-in-black/prd/204561376?clr=black&colourWayId=204561385', 'img_url': 'https://images.asos-media.com/products/hugo-dapolino-boyfriend-fit-t-shirt-in-black/204561376-1-black', 'sold_by': 'Asos'},
                                             {'name': 'ASOS DESIGN micro strappy cut out bodysuit in black', 'price': '$14.00', 'colour': 'Black', 'url': 'https://www.asos.com/asos-design/asos-design-micro-strappy-cut-out-bodysuit-in-black/prd/204574262?clr=black&colourWayId=204574263', 'img_url': 'https://images.asos-media.com/products/asos-design-micro-strappy-cut-out-bodysuit-in-black/204574262-1-black', 'sold_by': 'Asos'},
                                             {'name': 'ASOS DESIGN cowl neck top with bra detail in black', 'price': '$21.00', 'colour': 'Black', 'url': 'https://www.asos.com/asos-design/asos-design-cowl-neck-top-with-bra-detail-in-black/prd/204780015?clr=black&colourWayId=204780016', 'img_url': 'https://images.asos-media.com/products/asos-design-cowl-neck-top-with-bra-detail-in-black/204780015-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Topshop ruched side bandeau top in black', 'price': '$38.50', 'colour': 'Black', 'url': 'https://www.asos.com/topshop/topshop-ruched-side-bandeau-top-in-black/prd/204827898?clr=black&colourWayId=204827899', 'img_url': 'https://images.asos-media.com/products/topshop-ruched-side-bandeau-top-in-black/204827898-1-black', 'sold_by': 'Asos'},
                                             {'name': 'NA-KD bandeau top in black', 'price': '$14.00', 'colour': 'Black', 'url': 'https://www.asos.com/na-kd/na-kd-bandeau-top-in-black/prd/204942009?clr=black&colourWayId=204942011', 'img_url': 'https://images.asos-media.com/products/na-kd-bandeau-top-in-black/204942009-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Missguided Tall terrycloth bralet in black', 'price': '$13.50', 'colour': 'Black', 'url': 'https://www.asos.com/missguided-tall/missguided-tall-terrycloth-bralet-in-black/prd/202206200?clr=black&colourWayId=202206227', 'img_url': 'https://images.asos-media.com/products/missguided-tall-terrycloth-bralet-in-black/202206200-1-black', 'sold_by': 'Asos'},
                                             {'name': 'ASOS DESIGN faux leather corset with lace detail in black - part of a set', 'price': '$43.50', 'colour': 'Black', 'url': 'https://www.asos.com/asos-design/asos-design-faux-leather-corset-with-lace-detail-in-black-part-of-a-set/prd/203418914?clr=black&colourWayId=203418915', 'img_url': 'https://images.asos-media.com/products/asos-design-faux-leather-corset-with-lace-detail-in-black-part-of-a-set/203418914-1-black', 'sold_by': 'Asos'},
                                             {'name': 'ASOS DESIGN Curve oversized T-shirt in embroidered cutwork in black', 'price': '$29.00', 'colour': 'Black', 'url': 'https://www.asos.com/asos-curve/asos-design-curve-oversized-t-shirt-in-embroidered-cutwork-in-black/prd/204252909?clr=black&colourWayId=204252910', 'img_url': 'https://images.asos-media.com/products/asos-design-curve-oversized-t-shirt-in-embroidered-cutwork-in-black/204252909-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Hugo cropped Tee 3 relaxed fit script t-shirt in black', 'price': '$84.00', 'colour': 'Black', 'url': 'https://www.asos.com/hugo/hugo-cropped-tee-3-relaxed-fit-script-t-shirt-in-black/prd/204561137?clr=black&colourWayId=204561144', 'img_url': 'https://images.asos-media.com/products/hugo-cropped-tee-3-relaxed-fit-script-t-shirt-in-black/204561137-1-black', 'sold_by': 'Asos'},
                                             {'name': '4th & Reckless Lara cut-out detail bodysuit in black', 'price': '$34.00', 'colour': 'Black', 'url': 'https://www.asos.com/4th-reckless/4th-reckless-lara-cut-out-detail-bodysuit-in-black/prd/204669723?clr=black&colourWayId=204669733', 'img_url': 'https://images.asos-media.com/products/4th-reckless-lara-cut-out-detail-bodysuit-in-black/204669723-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Topshop pintuck tie up top in black', 'price': '$52.00', 'colour': 'Black', 'url': 'https://www.asos.com/topshop/topshop-pintuck-tie-up-top-in-black/prd/204776415?clr=black&colourWayId=204776417', 'img_url': 'https://images.asos-media.com/products/topshop-pintuck-tie-up-top-in-black/204776415-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Bershka seamless bandeau bodysuit in brown', 'price': '$18.50', 'colour': 'Black', 'url': 'https://www.asos.com/bershka/bershka-seamless-bandeau-bodysuit-in-brown/prd/205011551?clr=black&colourWayId=205011552', 'img_url': 'https://images.asos-media.com/products/bershka-seamless-bandeau-bodysuit-in-brown/205011551-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Heartbreak faux leather pointed hem corset top in black graffiti print', 'price': '$26.00', 'colour': 'Black', 'url': 'https://www.asos.com/heartbreak/heartbreak-faux-leather-pointed-hem-corset-top-in-black-graffiti-print/prd/203914593?clr=black&colourWayId=203914594', 'img_url': 'https://images.asos-media.com/products/heartbreak-faux-leather-pointed-hem-corset-top-in-black-graffiti-print/203914593-1-black', 'sold_by': 'Asos'},
                                             {'name': 'Nike Training Pro Dri-Fit cropped tank in black', 'price': '$48.00', 'colour': 'Black', 'url': 'https://www.asos.com/nike-training/nike-training-pro-dri-fit-cropped-tank-in-black/prd/204028341?clr=black&colourWayId=204028359', 'img_url': 'https://images.asos-media.com/products/nike-training-pro-dri-fit-cropped-tank-in-black/204028341-1-black', 'sold_by': 'Asos'}]}

class APITestCase(TestCase):

    def test_make_shein_request(self):
        # Function call to make the Shein API request
        formatted_res_shein = SHEIN_FORMATTED_RES
        shein_response = make_shein_request(formatted_res_shein)
        # Assertions to check the extracted information
        self.assertEqual(list(shein_response.keys()), list(SHEIN_MOCK_JSON_RESPONSE.keys()), ERROR_MESSAGE_SHEIN)
        for i in range(len(shein_response[PRODUCTS_KEY_SHEIN])):
            self.assertEqual(list(shein_response[PRODUCTS_KEY_SHEIN][i].keys()), list(SHEIN_MOCK_JSON_RESPONSE[PRODUCTS_KEY_SHEIN][i].keys()),ERROR_MESSAGE_SHEIN)
        print("\nPassed API-shein test successfully")

    def test_make_asos_request(self):
        # Function call to make the Shein API request
        asos_response = make_asos_request(ASOS_COLOR,ASOS_GENDER,ASOS_ITEM_TYPE)
        # Assertions to check the extracted information
        self.assertEqual(list(asos_response.keys()), list(ASOS_MOCK_JSON_RESPONSE.keys()), ERROR_MESSAGE_ASOS)
        for i in range(len(asos_response[PRODUCTS_KEY_ASOS])):
            self.assertEqual(list(asos_response[PRODUCTS_KEY_ASOS][i].keys()), list(ASOS_MOCK_JSON_RESPONSE[PRODUCTS_KEY_ASOS][i].keys()),ERROR_MESSAGE_ASOS)
        print("\nPassed API-asos test successfully")

